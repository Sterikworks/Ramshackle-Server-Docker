services:
  ramshackle:
    build:
      context: https://github.com/Sterikworks/Ramshackle-Server-Docker.git
      dockerfile: Dockerfile
    container_name: ramshackle-server
    restart: unless-stopped

    ports:
      - "27015:27015/udp" # steam port (do i even need this??)
      - "4999-5010:4999-5010/udp"   # lobby + battle-room port range (UDP)
      - "4999-5010:4999-5010/tcp"   # lobby + battle-room port range (TCP)
      # Use the above compact range instead of individual port mappings.

    volumes:
      - ./data/server:/srv/ramshackle/server
      - ./data/steamcmd:/srv/ramshackle/steamcmd
      - ./data/saves:/home/steam/.config/Mountainous Development/REMProject

    environment:
      # === STEAM CREDENTIALS (REQUIRED) ===
      - STEAM_USER=your_steam_username      # your Steam username
      - STEAM_PASS=your_password_here       # your Steam password
      - STEAM_GUARD=                        # Steam Guard code if prompted

      # === WORLD SETTINGS (REQUIRED) ===
      - SCENARIO=MyWorld                    # REQUIRED: change this to your world name!

      # === SERVER BRANCH ===
      - BRANCH=development                  # "public" or "development"
      - BRANCH_PASSWORD=                    # password if branch requires it

      # === OPTIONAL SETTINGS ===
      - MANIFEST_ID=                        # pin to specific version (leave empty for latest)
      - EXTRA_ARGS=-batchmode -nographics -debug -lobby -end  # server launch arguments
      - SERVER_BIN=/srv/ramshackle/server/REMProject.x86_64   # run binary directly, bypass start script

      # === FILE OWNERSHIP (Linux/Mac) ===
      - PUID=1000                           # your user ID (run 'id' to find)
      - PGID=1000                           # your group ID

      # === ADVANCED ===
      - RETRIES=3                           # retry attempts for Steam downloads
      - RETRY_SLEEP=10                      # seconds between retries

      # === FIXED VALUES (rarely change) ===
      - APP_ID=4021040
      - DEPOT_ID=4021043
      - PLATFORM=linux
      - BITNESS=64

    # Healthcheck kept but made intentionally conservative to avoid frequent container
    # restarts which can cause repeated steamcmd logins during startup.
    # If you want to disable the healthcheck entirely, set this to 'none' or remove
    # the block below.
    healthcheck:
      test: ["CMD", "/usr/local/bin/healthcheck.sh"]
      # Long interval reduces chance of repeated restart loops / login spam.
      interval: 5m
      # Allow more time for server to respond during cold starts.
      timeout: 30s
      # Fewer retries before marking unhealthy; tune as needed.
      retries: 3
